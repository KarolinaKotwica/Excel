<!DOCTYPE html>
<html lang="pl">

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1 user-scalable='no'">
        <meta name="description" content="Excelwpracy.pl - strona główna, ciekawostki ze świata Excela, pomoc, zlecenia, porady">
        <meta name="keywords" content="excel, excel praca, excel w pracy, vba, excel vba, excel wykresy, excel funkcje, excel formularze, excel online, microsoft excel, excel kurs, excel samouczek, excel podstawy">
        <title>VBA SAP</title>

        <link rel="stylesheet" href="less/style.css">
        <link href="https://fonts.googleapis.com/css?family=Sorts+Mill+Goudy" rel="stylesheet">
        <link href="fonts/cour.ttf" rel="stylesheet">

        <!--[if lt IE 9]>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
<!--[endif]-->

    </head>

    <body>

        <div class="wrapper">
            <!---------------------- NAVIGATION MENU ---------------------------------->
            <div class="sidebar">
                <input class="menu-btn" type="checkbox" id="menu-btn">
                <label class="menu-icon" for="menu-btn"><span class="navicon"></span></label>

                <div class="wrapper-nav" id="menu">
                    <a href="index.html" class="home">Strona główna</a>
                    <p class="name-nav">EXCEL</p>
                    <ul class="nav">
                        <li><a href="wykresy.html">Wykresy</a></li>
                        <li><a href="funkcje.html">Funkcje</a></li>
                    </ul>


                    <p class="name-nav">VBA</p>
                    <ul class="nav">
                        <li><a href="excel.html">Excel</a></li>
                        <li><a href="userforms.html">Formularze</a></li>
                        <li><a href="ribbon.html">Ribbon/Context Menu</a></li>
                        <li><a href="outlook.html">Outlook</a></li>
                        <li><a href="powerpoint.html">PowerPoint</a></li>
                        <li><a href="access.html">Access</a></li>
                        <li><a href="word.html">Word</a></li>
                        <li><a href="internet_explorer.html">Internet Explorer</a></li>
                        <li><a href="sap.html">SAP</a></li>
                        <li><a href="scriptingdictionary.html">Scripting.Dictionary</a></li>
                    </ul>

                    <!---------------------- Contact ---------------------->

                    <p class="contact">
                        W razie pytań lub zlecenia pracy, zapraszam do kontaktu:
                        <span class="email"><a href="mailto:rafal@exelwpracy.pl?Subject=Hello%20again" target="_top">rafal@excelwpracy.pl</a></span>
                    </p>

                </div>
            </div>

            <!--------------------------------- CONTEXT ---------------------------------->

            <div class="main" id="demo">

                <!-----------TEMATY -------------------->

                <div class="topics">

                    <div class="left-text">
                        <h1>SAP</h1>
                        <p>Jak połączyć excel z sapem?<br>
                            Krótkim będzie to tematem.<br>
                            Warto włączyć referencje,<br>
                            Potem zacząć ingerencję.<br>
                            Może jest metoda lepsza,<br>
                            Lecz ta nie jest najtępsza.<br>
                            Zresztą, innej przecież nie znam,<br>
                            Tą jedyną, więc Wam wyznam.<br><br>

                            Skrypt’y z sapa są niezbędne,<br>
                            Tak jak piwo moczopędne.<br>
                            Gdy już mam z nagrania plik,<br>
                            Robię wtedy taki myk:<br>
                            Tym sposobem definiuję<br>
                            Sesję, na niej potem operuję.<br>
                            W skrypcie wszystko mam gotowe,<br>
                            Pracy mniej jest o połowę.<br>
                        </p>
                    </div>

                    <div class="right-image"><img src="img/referencje_sap.PNG" alt="SAP referencje"></div>
                </div>
                <br>
                <div class="grey-field">
                    <p class="board"><span class="green">'funckja, która namierzy pierwszą otwartą transakcję w Sapie, dla bezpieczeństwa dodałem,<br>'żeby sprawdzał czy jest na stronie startowej - "Sap easy access"</span><br>Function createSApConnection()<br>   Set SapGuiAuto = GetObject("SAPGUI")<br>   If SapGuiAuto Is Nothing Then<br>   MsgBox "open SAP", vbCritical<br>   End<br>   End If<br><br>   Set sapApp = SapGuiAuto.GetScriptingEngine<br><br>   Set Connection = sapApp.Children(0)<br><br>   If Connection Is Nothing Then<br>   MsgBox "login to SAP", vbCritical<br>   >End<br>   End If<br><br>   Set createSApConnection = Connection.Children(0)<br>If Not UCase(createSApConnection.ActiveWindow.Text) Like UCase("Sap easy access*") Then<br>MsgBox "Go back to SAP starting page", vbCritical<br>   End<br>   End If<br>Set SapGuiAuto = Nothing<br>Set Connection = Nothing<br><br>End Function<br></p>
                </div>
                <br><br>

                <div class="grey-field">
                    <p class="board"><span class="green">'funckja inicjująca</span><br>Sub pobier()<br>Dim session As Object<br>Dim filespath As String<br><br>On Error GoTo 0<br>Set session = createSApConnection<br><br>If Not session Is Nothing Then<br>filespath = createTodaysFOlderonDesktop(CStr(Format(VBA.Date, "dd.mm.yyyy")))<br><br>Call getfromSAP(filespathpath, session)<br>MsgBox "done", vbOKOnly<br>Else<br>MsgBox "you should login to sap first"<br>End If<br>End Sub<br><br><span class="green">'tworzę folder z nazwą miesiąca i dniem na pulpicie</span><br>Public Function createTodaysFOlderonDesktop(day As String)<br>Dim path As String<br><br>path = "C:\users\" &amp; VBA.Environ("username") &amp; "\desktop\" &amp; VBA.MonthName(Month((CDate(Replace(day, ".", "/")))), True) &amp; "\"<br>If Dir(path, vbDirectory) = "" Then<br>  MkDir path<br>End If<br>path = Empty<br><br>path = "C:\users\" &amp; VBA.Environ("username") &amp; "\desktop\" &amp; VBA.MonthName(Month((CDate(Replace(day, ".", "/")))), True) &amp; "\" &amp; day &amp; "\"<br>If Dir(path, vbDirectory) = "" Then<br>  MkDir path<br>End If<br>createTodaysFOlderonDesktop = path<br>path = Empty<br><br>End Function<br></p>
                </div>
                <br><br>

                <div class="grey-field">
                    <p class="board"><span class="green">''''po wciśnięciu f8 - generowanie raportu wywołuję save as xxl<br>''''jak już wcześniej mówiłem – bazą jest nagrany skrypt z SAP<br>''nagrany vbs edytujemy i przenosimy zgrabnie do excela</span><br>session.findById("wnd[0]").sendVKey 8<br><br>Call PressDOwnloadASXXl(session, filespath, "nazwapliku.xlsx")<br></p>
                </div>
                <br><br>

                <div class="grey-field">
                    <p class="board">Sub PressDOwnloadASXXl(session As Object, filespath As String, filename As String)<br><br>thebeginning:<br><br>session.findById("wnd[0]/mbar/menu[0]/menu[3]/menu[1]").Select<span class="green">'export</span><br>session.findById("wnd[1]/usr/cmbG_LISTBOX").SetFocus<br>session.findById("wnd[1]/usr/cmbG_LISTBOX").Key = "08" <span class="green">'xxl</span><br>session.findById("wnd[1]/tbar[0]/btn[0]").press<br><br><br>session.findById("wnd[1]/tbar[0]/btn[0]").press<br><br>session.findById("wnd[1]/usr/subSUBSCREEN_STEPLOOP:SAPLSPO5:0150/sub:SAPLSPO5:0150/radSPOPLI-SELFLAG[0,0]").Select<br>session.findById("wnd[1]/usr/subSUBSCREEN_STEPLOOP:SAPLSPO5:0150/sub:SAPLSPO5:0150/radSPOPLI-SELFLAG[0,0]").SetFocus <spam class="green">''table</spam><br>session.findById("wnd[1]/tbar[0]/btn[0]").press<br>session.findById("wnd[1]/tbar[0]/btn[0]").press<br><br>If saveThisWorkbook(filespath, filename) = False Then <span class="green">''zapisuję nowootwarty plik</span><br>session.findById("wnd[1]/tbar[0]/btn[0]").press<br>GoTo thebeginning<br>End If<br>session.findById("wnd[1]/tbar[0]/btn[0]").press <span class="green">'powrót</span><br><br>End Sub<br></p>
                </div>
                <br><br>

                <div class="grey-field">
                    <p class="board">Function saveThisWorkbook(foldername As String, filename As String) As Boolean<br>Dim idmsWB As Workbook<br><br>If isWorkbookOpened("Worksheet in Basis (1)") = True Then<br>    Workbooks("Worksheet in Basis (1)").Activate<br>   Else<br>   saveThisWorkbook = False<br>   Exit Function<br><br>End If<br><br>   ActiveWorkbook.SaveAs foldername &amp; filename, 51 <span class="green">'51 = xlsx</span><br>   saveThisWorkbook = True<br><br>End Function<br></p>
                </div>
                <br><br>
                
                <div class="grey-field">
                    <p class="board"><span class="green">'prosta pętla po otwartych oknach excela, która znajdzie otwarty plik po nazwie</span><br>Function isWorkbookOpened(ws As String) As Boolean<br>Dim w As Workbook<br>If Application.Workbooks.Count = 0 Then Application.Workbooks.Add<br><br>For Each w In Application.Workbooks<br>   If w.Name = ws Then<br>    isWorkbookOpened = True<br>   Exit Function<br>   End If<br>Next<br><br>isWorkbookOpened = False<br><br>End Function<br></p>
                </div>
                <br><br>
                

                <div class="topics">
                    <div class="left-text">
                        <p>
                            Wiele więcej tego mam,<br>
                            Piszcie, dzwońcie, to dodam.<br>
                        </p>
                    </div>
                </div>

                <br><br>
            </div>
        </div>



        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src=" http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>

  
        <script src="js/script.js"></script>
 


    </body>

</html>
